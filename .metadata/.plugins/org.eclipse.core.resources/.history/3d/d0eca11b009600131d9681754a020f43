import java.util.ArrayList;
import java.sql.*;


public class Segment extends BaseClass {

	private int id;
	private int toID;
	private int fromID;
	private int VehicleID;
	private String mode;
	private double distance;
	private double cost;
	private int departureTime;
	private int arrivalTime;
	
	public Segment()
	{
		MarkNew();
	}
	public Segment(int id)
	{
		this.id=id;
	}

	public int getID()
	{
		return id;
	}
	
	public void setStartLocation(int id)
	{
		if(fromID!=id)
		{
			fromID=id;
			MarkDirty();
		}
	}
	public void setStartLocation(Location l)
	{
		if(fromID!=l.getID())
		{
			fromID=l.getID();
			MarkDirty();
		}
	}
	public int getStartLocationID()
	{
		return fromID;
	}
	public Location getStartLocation()
	{
		return Location.Load(fromID);
	}
	
	public void setEndLocation(int id)
	{
		if(toID!=id)
		{
			toID=id;
			MarkDirty();
		}
	}
	public void setEndLocation(Location l)
	{
		if(toID!=l.getID())
		{
			toID=l.getID();
			MarkDirty();
		}
	}
	public int getEndLocationID()
	{
		return toID;
	}
	public Location getEndLocation()
	{
		return Location.Load(toID);
	}
	
	public void setVehicle(Vehicle v)
	{
		if(this.VehicleID!=v.getId() || !this.mode.equals(v.getTravelType()))
		{
			this.VehicleID=v.getId();
			mode=v.getTravelType();
			MarkDirty();
		}
	}
	public void setVehicle(int id,String travelMode)
	{
		//todo:ADD check on travel mode: if not exist do nothing
		if(this.VehicleID!=id || !this.mode.equals(travelMode))
		{
			this.VehicleID=id;
			mode=travelMode;
			MarkDirty();
		}
	}
	public Vehicle getVehcle()
	{
		switch(Vehicle.loadType(mode))
		{
			case Truck:
				return Truck.Load(this.VehicleID);
			case Rail:
				return Rail.Load(this.VehicleID);
			case Cargo:
				return Cargo.Load(this.VehicleID);
			case Plane:
				return Plane.Load(this.VehicleID);
			case Bike:
				return Bike.Load(this.VehicleID);
		
		}
		return null;
	}
	public static ArrayList<Segment> LoadAll(String where)
	{
		ArrayList<Segment> returnList = new ArrayList<Segment>();
		try
		{
			Connection c =getConnection();
			Statement stm = c.createStatement();
			ResultSet rs = stm.executeQuery("Select * from Segment " + where);
			
			while(rs.next())
			{
				returnList.add(BuildFromDataRow(rs));
			}
		}
		catch(Exception ex)
		{
			System.out.println("Error " + ex);
		}
		return returnList;
	}
	public static Segment BuildFromDataRow(ResultSet rs)
	{
		Segment s = new Segment();
		try 
		{
			s.id=rs.getInt("SegmentID");
			s.fromID=rs.getInt("FromLocationID");
			s.toID=rs.getInt("ToLocationID");
			s.VehicleID=rs.getInt("VehicleID");
			s.mode=rs.getString("ModeType");
			s.distance=rs.getDouble("Distance");
			s.cost=rs.getDouble("Cost");
			s.departureTime=rs.getInt("TimeOfDeparture");
			s.arrivalTime=rs.getInt("TimeOfArrival");
		}
		catch(Exception ex)
		{
			System.out.println("Error " + ex);
		}
		return s;
	}
	
	public static ArrayList<Segment> LoadAllAtLocation(Location l)
	{
		ArrayList<Segment> returnList = new ArrayList<Segment>();
		try
		{
			Connection c = getConnection();
			ResultSet rs = c.createStatement().executeQuery("Select * from Segment where FromLocationID = '" + l.getID() +"'");
			while(rs.next())
				returnList.add(BuildFromDataRow(rs));
		}
		catch(Exception ex)
		{
			System.out.println("Error " + ex);
		}
		return returnList;
	}
	
	public static ArrayList<Segment> LoadAllAtLocation(Location l, int startTime)
	{
		ArrayList<Segment> returnList = new ArrayList<Segment>();
		try
		{
			Connection c = getConnection();
			ResultSet rs = c.createStatement().executeQuery("Select * from Segment where FromLocationID = '" + l.getID() + "' and TimeOfDeparture > " + startTime);
			while(rs.next())
				returnList.add(BuildFromDataRow(rs));
		}
		catch(Exception ex)
		{
			System.out.println("Error " + ex);
		}
		return returnList;
	}
	
	@Override
	void Update() {
		if(isNew())
		{
		
		}
		else
		{
			if(isDirty())
			{
				
			}
		}

	}

	@Override
	void Delete() {
		// TODO Auto-generated method stub

	}
	@Override
	public String toString()
	{
		return this.fromID + "   " + this.toID;
	}

}
